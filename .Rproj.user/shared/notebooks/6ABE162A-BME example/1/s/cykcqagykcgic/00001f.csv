"0","HRs <- cbind("
"0","  hrS = c(1, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7),"
"0","  hrSc = c(1, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2)"
"0",")"
"0",""
"0","simulate_scenario <- function(i, HRs) {"
"0","  hazard_S  <- log(2)/c(9, 9 / HRs[i, ""hrS""]) #currently assume med is same for BM+ and BM- in control"
"0","  hazard_Sc <- log(2)/c(9, 9 / HRs[i, ""hrSc""])"
"0","  "
"0","  res <- getOC_BME_GS(seed = 2025 + i, #make sure scenarios are statistically independent "
"0","                      nsim = 500,"
"0","                      nF = 600, nS_additional = 100,"
"0","                      prop_S = 0.5,"
"0","                      duration = 20,"
"0","                      duration_additional = 3,"
"0","                      targetEvents.Sc = 105, HR.Sc.threshold = 0.9,"
"0","                      targetEvents.S.noexpand = c(150, 210),"
"0","                      targetEvents.S.expand = c(200, 280),"
"0","                      targetEvents.F = c(300, 420),"
"0","                      hazard_S  = hazard_S, hazard_Sc = hazard_Sc,"
"0","                      dropout_S = c(0, 0), dropout_Sc = c(0, 0), w = 1, ratio = 1,"
"0","                      orr_S = 0.1, orr_Sc = 0.1, rho_S = 0.7, rho_Sc = 0.7,"
"0","                      alpha1 = 0.0125, alpha2 = 0.0125,"
"0","                      selection = ""orr"","
"0","                      orr_thres = 0.01, orr_number = 200"
"0","                      )"
"0","                    "
"0","  power.Fs <- res$F.reject"
"0","  power.Ss <- res$S.reject"
"0","  expansion <- res$expand"
"0","  "
"0","  return(c("
"0","    Power_F = mean(power.Fs),"
"0","    Power_S = mean(power.Ss),"
"0","    Overall_Power = mean(power.Fs | power.Ss),"
"0","    Prob_Expand = mean(expansion),"
"0","    Avg_Sample_Size = 600 + 100 * mean(expansion)"
"0","  ))"
"0","}"
"0",""
"0","# Setup parallel cluster"
"0","n_cores <- detectCores() - 1"
"0","cl <- makeCluster(n_cores)"
"0","clusterExport(cl, varlist = c("
"0","  ""HRs"","
"0","  ""simulate_scenario"","
"0","  ""getOC_BME_GS"","
"0","  ""getZtest_GS"","
"0","  ""getZstats_GS"","
"0","  ""getZstats_IA"","
"0","  ""simu_enrich_trial"","
"0","  ""cut_by_event"","
"0","  ""logrank.one.sided"","
"0","  ""log"""
"0","))"
"0",""
"0",""
"0","# simulation"
"0","results_list <- lapply(1:nrow(HRs), function(i) simulate_scenario(i, HRs))"
"0",""
"0","# Stop cluster"
"0","stopCluster(cl)"
"0",""
"0","results <- do.call(rbind, results_list)"
"0","results_df <- as.data.frame(cbind(HRs, results))"
"0",""
"0","print(results_df)"
